<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GÃ¼nlÃ¼k Takip ProgramÄ± (Full Versiyon)</title>
    <style>
        :root {
            --bg-color: #f4f6f8;
            --container-bg: #ffffff;
            --text-color: #333;
            --border-color: #ddd;
        }
        body.dark {
            --bg-color: #121212;
            --container-bg: #1e1e1e;
            --text-color: #eaeaea;
            --border-color: #333;
        }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: var(--bg-color); color: var(--text-color); padding: 20px; transition: 0.3s; }
        .container { max-width: 900px; margin: auto; background: var(--container-bg); padding: 20px; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        
        /* Takvim ve Grid */
        .weekdays { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; margin-top: 15px; font-weight: bold; text-align: center; }
        #monthDays { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; margin-top: 10px; }
        #monthDays button { 
            position: relative; border: 1px solid var(--border-color); border-radius: 10px; 
            background: var(--container-bg); color: var(--text-color); padding: 10px 0; cursor: pointer; transition: 0.2s;
        }
        #monthDays button.active { background: #c8e6c9; border-color: #66bb6a; color: #1b5e20; }
        #monthDays button.today { outline: 2px solid #4caf50; }
        
        /* GÃ¶rev KartlarÄ± */
        .task-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 12px; margin-top: 20px; }
        .task-card { 
            border: 1px solid var(--border-color); border-radius: 12px; padding: 15px; 
            background: var(--container-bg); cursor: pointer; position: relative; word-break: break-word;
        }
        .task-card.completed { background: #e8f5e9; border-color: #66bb6a; text-decoration: line-through; color: #777; }
        .task-card.delete-hold { background: #ffebee !important; border-color: #e53935 !important; animation: shake 0.2s infinite; }

        /* Noktalar */
        .day-dot { width: 6px; height: 6px; border-radius: 50%; margin: 4px auto 0; background: #ccc; }
        .dot-has { background: #ffd54f; }
        .dot-done { background: #81c784; }

        /* ArayÃ¼z ElemanlarÄ± */
        .controls { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 15px; align-items: center; }
        input, button { padding: 10px; border-radius: 8px; border: 1px solid var(--border-color); background: var(--container-bg); color: var(--text-color); }
        button:hover { opacity: 0.8; }
        #darkToggle { font-size: 1.2rem; cursor: pointer; margin-left: auto; }
        
        @keyframes shake { 0% {transform: rotate(1deg)} 50% {transform: rotate(-1deg)} 100% {transform: rotate(1deg)} }
        hr { border: 0; border-top: 1px solid var(--border-color); margin: 20px 0; }
    </style>
</head>
<body>

<div class="container">
    <div class="controls">
        <input type="month" id="monthInput">
        <button id="toggleMulti">âž• Ã‡oklu SeÃ§im: KapalÄ±</button>
        <button id="clearSelected" style="background:#ffebee; color:#c62828;">ðŸ§¹ SeÃ§ili GÃ¼nleri Sil</button>
        <div id="darkToggle">ðŸŒ™</div>
    </div>

    <div id="dayCounter">
        <strong>Durum:</strong> 
        <span style="color:#2e7d32;">ðŸŸ¢ Tamam: <span id="doneCount">0</span></span> | 
        <span style="color:#f9a825;">ðŸŸ¡ Bekleyen: <span id="pendingCount">0</span></span>
    </div>

    <div class="weekdays">
        <div>Pt</div><div>Sl</div><div>Ã‡r</div><div>Pr</div><div>Cm</div><div>Ct</div><div>Pz</div>
    </div>
    <div id="monthDays"></div>

    <hr>
    
    <div class="controls">
        <input type="text" id="taskInput" placeholder="Yeni gÃ¶rev yaz..." style="flex-grow:1">
        <button id="addBtn" style="background:#4caf50; color:white;">âž• Ekle</button>
    </div>
    
    <div id="taskGrid" class="task-grid"></div>

    <hr>

    <details>
        <summary style="cursor:pointer; font-weight:bold;">ðŸ’¾ Veri YÃ¶netimi (Yedekle/YÃ¼kle)</summary>
        <div style="padding:15px; border:1px dashed #ccc; margin-top:10px; border-radius:8px;">
            <button id="backupBtn">ðŸ“¤ Dosya Olarak Kaydet</button>
            <p style="font-size:0.8rem; margin:10px 0;">YedeÄŸi geri yÃ¼klemek iÃ§in dosya seÃ§in:</p>
            <input type="file" id="restoreInput" accept=".json">
            <button id="restoreBtn" style="background:#e3f2fd; color:#1565c0;">ðŸ“¥ YÃ¼kle</button>
        </div>
    </details>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    let currentDate = null;
    let selectedDays = [];
    let multiSelect = false;

    const monthInput = document.getElementById('monthInput');
    const monthDays = document.getElementById('monthDays');
    const taskGrid = document.getElementById('taskGrid');
    const taskInput = document.getElementById('taskInput');
    const addBtn = document.getElementById('addBtn');
    const toggleMultiBtn = document.getElementById('toggleMulti');

    // Veri FonksiyonlarÄ±
    const getDays = () => JSON.parse(localStorage.getItem('days')) || {};
    const saveDays = (d) => {
        localStorage.setItem('days', JSON.stringify(d));
        updateDayCounter();
        renderMonthDots();
    };

    // Takvim Ã‡izimi
    function renderCalendar() {
        monthDays.innerHTML = '';
        if (!monthInput.value) return;
        
        const [y, m] = monthInput.value.split('-').map(Number);
        const firstDay = (new Date(y, m - 1, 1).getDay() + 6) % 7;
        const daysInMonth = new Date(y, m, 0).getDate();
        const todayStr = new Date().toISOString().split('T')[0];

        for (let i = 0; i < firstDay; i++) monthDays.appendChild(document.createElement('div'));

        const daysData = getDays();
        for (let d = 1; d <= daysInMonth; d++) {
            const iso = `${y}-${String(m).padStart(2, '0')}-${String(d).padStart(2, '0')}`;
            const btn = document.createElement('button');
            btn.textContent = d;
            btn.dataset.date = iso;
            if(iso === todayStr) btn.classList.add('today');
            if(selectedDays.includes(iso)) btn.classList.add('active');

            const dot = document.createElement('div');
            dot.className = 'day-dot';
            btn.appendChild(dot);

            btn.onclick = () => {
                if (!multiSelect) {
                    selectedDays = [iso];
                    document.querySelectorAll('#monthDays button').forEach(b => b.classList.remove('active'));
                } else {
                    if (selectedDays.includes(iso)) selectedDays = selectedDays.filter(x => x !== iso);
                    else selectedDays.push(iso);
                }
                btn.classList.toggle('active', selectedDays.includes(iso));
                currentDate = iso;
                loadTasks();
            };

            // GÃ¼n silme (BasÄ±lÄ± tutma)
            let timer;
            btn.onmousedown = btn.ontouchstart = () => {
                timer = setTimeout(() => {
                    if(confirm(`${iso} tarihindeki tÃ¼m gÃ¶revler silinsin mi?`)) {
                        const days = getDays();
                        delete days[iso];
                        saveDays(days);
                        loadTasks();
                    }
                }, 800);
            };
            btn.onmouseup = btn.onmouseleave = btn.ontouchend = () => clearTimeout(timer);

            monthDays.appendChild(btn);
        }
        renderMonthDots();
    }

    // GÃ¶revleri YÃ¼kle
    function loadTasks() {
        taskGrid.innerHTML = '';
        if (!currentDate) return;
        const tasks = getDays()[currentDate] || [];
        
        tasks.forEach((task, index) => {
            const card = document.createElement('div');
            card.className = `task-card ${task.done ? 'completed' : ''}`;
            card.textContent = task.text;
            
            card.onclick = () => {
                const days = getDays();
                days[currentDate][index].done = !days[currentDate][index].done;
                saveDays(days);
                loadTasks();
            };

            let timer;
            card.onmousedown = card.ontouchstart = (e) => {
                card.classList.add('delete-hold');
                timer = setTimeout(() => {
                    const days = getDays();
                    days[currentDate].splice(index, 1);
                    saveDays(days);
                    loadTasks();
                }, 800);
            };
            card.onmouseup = card.onmouseleave = card.ontouchend = () => {
                clearTimeout(timer);
                card.classList.remove('delete-hold');
            };

            taskGrid.appendChild(card);
        });
    }

    // Ã‡oklu SeÃ§im
    toggleMultiBtn.onclick = () => {
        multiSelect = !multiSelect;
        toggleMultiBtn.textContent = multiSelect ? "âœ… Ã‡oklu SeÃ§im: AÃ§Ä±k" : "âž• Ã‡oklu SeÃ§im: KapalÄ±";
        if(!multiSelect) {
            selectedDays = currentDate ? [currentDate] : [];
            renderCalendar();
        }
    };

    // SeÃ§ili GÃ¼nleri Temizle
    document.getElementById('clearSelected').onclick = () => {
        if(selectedDays.length === 0) return alert("SeÃ§ili gÃ¼n yok.");
        if(confirm("SeÃ§ili gÃ¼nlerdeki TÃœM gÃ¶revler silinecek. OnaylÄ±yor musunuz?")) {
            const days = getDays();
            selectedDays.forEach(date => delete days[date]);
            saveDays(days);
            selectedDays = [];
            currentDate = null;
            renderCalendar();
            loadTasks();
        }
    };

    // SayaÃ§lar ve Noktalar
    function updateDayCounter() {
        const days = getDays();
        let done = 0, pending = 0;
        for (const date in days) {
            if (days[date].length > 0) {
                if (days[date].every(t => t.done)) done++;
                else pending++;
            }
        }
        document.getElementById('doneCount').textContent = done;
        document.getElementById('pendingCount').textContent = pending;
    }

    function renderMonthDots() {
        const daysData = getDays();
        document.querySelectorAll('#monthDays button[data-date]').forEach(btn => {
            const iso = btn.dataset.date;
            const dot = btn.querySelector('.day-dot');
            if(!dot) return;
            dot.className = 'day-dot';
            if (daysData[iso] && daysData[iso].length > 0) {
                dot.classList.add(daysData[iso].every(t => t.done) ? 'dot-done' : 'dot-has');
            }
        });
    }

    // GÃ¶rev Ekleme
    addBtn.onclick = () => {
        const val = taskInput.value.trim();
        if (!val || selectedDays.length === 0) return alert('GÃ¼n seÃ§in ve gÃ¶rev yazÄ±n');
        const days = getDays();
        selectedDays.forEach(d => {
            if (!days[d]) days[d] = [];
            days[d].push({ text: val, done: false });
        });
        saveDays(days);
        taskInput.value = '';
        loadTasks();
    };

    // Yedekleme ve Geri YÃ¼kleme
    document.getElementById('backupBtn').onclick = () => {
        const dataStr = JSON.stringify({days: getDays()});
        const blob = new Blob([dataStr], {type: "application/json"});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `takip-yedek-${new Date().toLocaleDateString()}.json`;
        a.click();
    };

    document.getElementById('restoreBtn').onclick = () => {
        const file = document.getElementById('restoreInput').files[0];
        if(!file) return alert("LÃ¼tfen bir yedek dosyasÄ± seÃ§in.");
        const reader = new FileReader();
        reader.onload = (e) => {
            try {
                const imported = JSON.parse(e.target.result);
                if(imported.days) {
                    saveDays(imported.days);
                    renderCalendar();
                    alert("Veriler baÅŸarÄ±yla yÃ¼klendi!");
                }
            } catch(err) { alert("GeÃ§ersiz dosya formatÄ±."); }
        };
        reader.readAsText(file);
    };

    // Tema YÃ¶netimi
    const dt = document.getElementById('darkToggle');
    dt.onclick = () => {
        document.body.classList.toggle('dark');
        const isDark = document.body.classList.contains('dark');
        dt.textContent = isDark ? "â˜€ï¸" : "ðŸŒ™";
        localStorage.setItem('theme', isDark ? 'dark' : 'light');
    };
    if(localStorage.getItem('theme') === 'dark') {
        document.body.classList.add('dark');
        dt.textContent = "â˜€ï¸";
    }

    // BaÅŸlangÄ±Ã§
    const now = new Date();
    monthInput.value = `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}`;
    renderCalendar();
    updateDayCounter();
    monthInput.onchange = renderCalendar;
    // --- AY DEÄžÄ°ÅžTÄ°RME Ã–ZELLÄ°KLERÄ° (Swipe & Wheel) ---

    const changeMonth = (direction) => {
        const [year, month] = monthInput.value.split("-").map(Number);
        let date = new Date(year, month - 1 + direction, 1);
        monthInput.value = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, "0")}`;
        renderCalendar();
    };

    // 1. Mobil iÃ§in KaydÄ±rma (Swipe) DesteÄŸi
    let touchStartX = 0;
    monthDays.addEventListener("touchstart", e => { touchStartX = e.changedTouches[0].screenX; }, {passive: true});
    monthDays.addEventListener("touchend", e => {
        let touchEndX = e.changedTouches[0].screenX;
        let diff = touchEndX - touchStartX;
        if (Math.abs(diff) > 50) { // 50px'den fazla kaydÄ±rÄ±lmÄ±ÅŸsa
            changeMonth(diff > 0 ? -1 : 1); // SaÄŸa kaydÄ±rÄ±nca geri, sola kaydÄ±rÄ±nca ileri
        }
    }, {passive: true});

    // 2. MasaÃ¼stÃ¼ iÃ§in Mouse TekerleÄŸi DesteÄŸi
    monthDays.addEventListener("wheel", e => {
        if (e.deltaY > 0) changeMonth(1);  // AÅŸaÄŸÄ± kaydÄ±rÄ±nca sonraki ay
        else changeMonth(-1);             // YukarÄ± kaydÄ±rÄ±nca Ã¶nceki ay
        e.preventDefault(); 
    }, {passive: false});
});
</script>
</body>
</html>
