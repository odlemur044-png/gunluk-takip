<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G√ºnl√ºk Takip - Estetik Pro</title>
    <style>
        :root {
            --bg-color: #f0f2f5;
            --container-bg: rgba(255, 255, 255, 0.9);
            --text-color: #2c3e50;
            --border-color: #e0e6ed;
            --accent-color: #6366f1; /* Modern Indigo */
            --success-color: #22c55e;
            --pending-color: #f59e0b;
            --danger-color: #ef4444;
            --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        body.dark {
            --bg-color: #0f172a; /* Derin Gece Mavisi */
            --container-bg: rgba(30, 41, 59, 0.8);
            --text-color: #f1f5f9;
            --border-color: #334155;
            --accent-color: #818cf8;
            --card-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
        }
        body { 
            font-family: 'Inter', system-ui, -apple-system, sans-serif; 
            background: var(--bg-color); 
            color: var(--text-color); 
            padding: 15px; 
            transition: background 0.4s, color 0.4s; 
            user-select: none;
            background-image: radial-gradient(circle at 10% 20%, rgba(99, 102, 241, 0.05) 0%, transparent 20%), 
                              radial-gradient(circle at 90% 80%, rgba(99, 102, 241, 0.05) 0%, transparent 20%);
        }
        .container { 
            max-width: 800px; margin: auto; 
            background: var(--container-bg); 
            backdrop-filter: blur(10px);
            padding: 25px; border-radius: 24px; 
            box-shadow: var(--card-shadow);
            border: 1px solid var(--border-color);
        }
        
        /* Butonlar ve Kontroller */
        .controls { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; align-items: center; }
        input, button { 
            padding: 10px 16px; border-radius: 12px; border: 1px solid var(--border-color); 
            background: var(--container-bg); color: var(--text-color); 
            font-size: 0.9rem; font-weight: 500; cursor: pointer; transition: 0.2s;
        }
        button:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        #addBtn { background: var(--accent-color); color: white; border: none; }
        #clearSelected { background: rgba(239, 68, 68, 0.1); color: var(--danger-color); border-color: rgba(239, 68, 68, 0.2); }
        
        /* Takvim */
        .weekdays { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; margin-top: 15px; font-weight: 700; text-align: center; color: var(--accent-color); font-size: 0.75rem; text-transform: uppercase; }
        #monthDays { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; margin-top: 10px; touch-action: none; }
        #monthDays button { 
            border: 1px solid var(--border-color); border-radius: 14px; 
            background: transparent; color: var(--text-color); padding: 12px 0; font-weight: 600;
        }
        #monthDays button.active { background: var(--accent-color) !important; color: white !important; border-color: var(--accent-color); transform: scale(1.05); }
        #monthDays button.today { border: 2px solid var(--accent-color); color: var(--accent-color); }
        
        /* Kompakt G√∂rev Kartlarƒ± */
        .task-grid { display: grid; gap: 10px; margin-top: 20px; }
        .view-grid { grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); }
        .view-list { grid-template-columns: 1fr; }
        .task-card { 
            border: 1px solid var(--border-color); border-radius: 15px; padding: 12px; 
            background: var(--container-bg); cursor: pointer; text-align: center;
            font-size: 0.85rem; transition: 0.3s; box-shadow: 0 2px 4px rgba(0,0,0,0.02);
            display: flex; align-items: center; justify-content: center; min-height: 55px;
        }
        .task-card.completed { background: rgba(34, 197, 94, 0.1); border-color: var(--success-color); color: var(--success-color); opacity: 0.7; }
        .task-card.delete-hold { background: var(--danger-color) !important; color: white !important; animation: shake 0.2s infinite; }

        /* Noktalar */
        .day-dot { width: 5px; height: 5px; border-radius: 50%; margin: 4px auto 0; background: #94a3b8; }
        .dot-has { background: var(--pending-color); }
        .dot-done { background: var(--success-color); box-shadow: 0 0 6px var(--success-color); }
        .dot-late { background: var(--danger-color); box-shadow: 0 0 6px var(--danger-color); }

        /* ƒ∞statistik Paneli */
        .stats { background: rgba(99, 102, 241, 0.08); padding: 12px; border-radius: 15px; display: flex; justify-content: space-around; font-size: 0.85rem; font-weight: 600; margin-bottom: 15px; }
        
        /* Yardƒ±m Sekmesi */
        .help-section { margin-top: 25px; border-radius: 15px; background: rgba(0,0,0,0.02); overflow: hidden; }
        .help-trigger { padding: 12px; cursor: pointer; font-size: 0.85rem; font-weight: 700; color: var(--accent-color); text-align: center; }
        .help-content { font-size: 0.8rem; display: none; padding: 15px; border-top: 1px solid var(--border-color); }
        
        @keyframes shake { 0%{transform:rotate(1deg)} 50%{transform:rotate(-1deg)} 100%{transform:rotate(1deg)} }
        hr { border: 0; border-top: 1px solid var(--border-color); margin: 20px 0; }
    </style>
</head>
<body>

<div class="container">
    <div class="controls">
        <input type="month" id="monthInput">
        <div style="margin-left:auto; display:flex; gap:8px;">
            <div id="viewToggle" title="G√∂r√ºn√ºm">üìã</div>
            <div id="darkToggle">üåô</div>
        </div>
    </div>

    <div class="stats">
        <span>üü¢ <span id="doneCount">0</span> Tamamlanan</span>
        <span>üü° <span id="pendingCount">0</span> Bekleyen</span>
    </div>

    <div class="controls">
        <button id="toggleMulti">‚ûï √áoklu Se√ßim</button>
        <button id="clearSelected">üóëÔ∏è Temizle</button>
    </div>

    <div class="weekdays">
        <div>Pzt</div><div>Sal</div><div>√áar</div><div>Per</div><div>Cum</div><div>Cmt</div><div>Paz</div>
    </div>
    <div id="monthDays"></div>

    <hr>
    
    <div class="controls">
        <input type="text" id="taskInput" placeholder="Neler yapacaksƒ±n?" style="flex-grow:1">
        <button id="addBtn">Ekle</button>
    </div>
    
    <div id="taskGrid" class="task-grid view-grid"></div>

    <div class="help-section">
        <div class="help-trigger" onclick="const h=document.getElementById('helpContent'); h.style.display = h.style.display === 'block' ? 'none' : 'block'">
            ‚ú® Kullanƒ±m ƒ∞pu√ßlarƒ±nƒ± G√∂r
        </div>
        <div id="helpContent" class="help-content">
            <b>‚Ä¢ Boyama Modu:</b> √áoklu se√ßim a√ßƒ±kken g√ºnlerin √ºzerinde s√ºr√ºkleyerek hƒ±zlƒ± se√ß. <br>
            <b>‚Ä¢ Hƒ±zlƒ± Silme:</b> G√ºnlere veya g√∂revlere uzun bas (1sn). <br>
            <b>‚Ä¢ Navigasyon:</b> Takvimi kaydƒ±rarak (swipe) aylar arasƒ± ge√ßi≈ü yap. <br>
            <b>‚Ä¢ Renkler:</b> Kƒ±rmƒ±zƒ± noktalar "ge√ßmi≈üteki eksikleri" temsil eder, onlarƒ± ye≈üile √ßevir!
        </div>
    </div>

    <details style="margin-top:20px; font-size:0.8rem; opacity:0.7;">
        <summary style="cursor:pointer">‚öôÔ∏è Geli≈ümi≈ü Ayarlar (Yedekleme)</summary>
        <div style="padding:15px; display:flex; flex-direction:column; gap:10px;">
            <button id="backupBtn">üì§ Verileri Yedekle (.json)</button>
            <input type="file" id="restoreInput" accept=".json">
            <button id="restoreBtn">üì• Yedeƒüi Geri Y√ºkle</button>
        </div>
    </details>
</div>

<script>
// MANTIK VE FONKSƒ∞YONLAR (T√ºm √∂zellikler korundu)
document.addEventListener('DOMContentLoaded', () => {
    let currentDate = null; let selectedDays = []; let multiSelect = false; let isDragging = false;
    let currentView = localStorage.getItem('taskView') || 'grid';

    const monthInput = document.getElementById('monthInput');
    const monthDays = document.getElementById('monthDays');
    const taskGrid = document.getElementById('taskGrid');
    const taskInput = document.getElementById('taskInput');
    const addBtn = document.getElementById('addBtn');
    const toggleMultiBtn = document.getElementById('toggleMulti');
    const viewToggle = document.getElementById('viewToggle');

    const getDays = () => JSON.parse(localStorage.getItem('days')) || {};
    const saveDays = (d) => { localStorage.setItem('days', JSON.stringify(d)); updateDayCounter(); renderMonthDots(); };

    function updateView() {
        taskGrid.className = `task-grid view-${currentView}`;
        viewToggle.textContent = currentView === 'grid' ? 'üìã' : '‚∏Ω‚∏Ω‚∏Ω‚∏Ω‚∏Ω‚∏Ω';
        localStorage.setItem('taskView', currentView);
    }
    viewToggle.onclick = () => { currentView = currentView === 'grid' ? 'list' : 'grid'; updateView(); };
    updateView();

    function renderCalendar() {
        monthDays.innerHTML = '';
        if (!monthInput.value) return;
        const [y, m] = monthInput.value.split('-').map(Number);
        const firstDay = (new Date(y, m - 1, 1).getDay() + 6) % 7;
        const daysInMonth = new Date(y, m, 0).getDate();
        const todayStr = new Date().toLocaleDateString('sv-SE');

        for (let i = 0; i < firstDay; i++) monthDays.appendChild(document.createElement('div'));

        for (let d = 1; d <= daysInMonth; d++) {
            const iso = `${y}-${String(m).padStart(2, '0')}-${String(d).padStart(2, '0')}`;
            const btn = document.createElement('button');
            btn.textContent = d; btn.dataset.date = iso;
            if(iso === todayStr) btn.classList.add('today');
            if(selectedDays.includes(iso)) btn.classList.add('active');

            const dot = document.createElement('div');
            dot.className = 'day-dot';
            btn.appendChild(dot);

            const handleInteraction = (e) => {
                if(multiSelect && (isDragging || e.type === 'click' || e.type === 'touchstart')) {
                    if (!selectedDays.includes(iso)) { selectedDays.push(iso); btn.classList.add('active'); }
                } else if(!multiSelect && (e.type === 'click' || e.type === 'touchstart')) {
                    selectedDays = [iso];
                    document.querySelectorAll('#monthDays button').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                }
                currentDate = iso; loadTasks();
            };

            btn.addEventListener('mousedown', () => { if(multiSelect) isDragging = true; });
            btn.addEventListener('mouseenter', (e) => { if(isDragging) handleInteraction(e); });
            btn.addEventListener('click', handleInteraction);

            let timer;
            btn.onmousedown = btn.ontouchstart = (e) => {
                if(multiSelect) isDragging = true;
                timer = setTimeout(() => { if(!isDragging && confirm(`${iso} silinsin mi?`)) { const days = getDays(); delete days[iso]; saveDays(days); loadTasks(); } }, 1000);
            };
            btn.onmouseup = btn.ontouchend = () => { isDragging = false; clearTimeout(timer); };
            monthDays.appendChild(btn);
        }
        renderMonthDots();
    }

    monthDays.addEventListener('touchmove', (e) => {
        if (!multiSelect) return;
        e.preventDefault();
        const touch = e.touches[0];
        const target = document.elementFromPoint(touch.clientX, touch.clientY);
        if (target && target.tagName === 'BUTTON' && target.dataset.date) {
            const iso = target.dataset.date;
            if (!selectedDays.includes(iso)) { selectedDays.push(iso); target.classList.add('active'); currentDate = iso; loadTasks(); }
        }
    }, { passive: false });

    window.addEventListener('mouseup', () => isDragging = false);

    function loadTasks() {
        taskGrid.innerHTML = '';
        if (!currentDate) return;
        const tasks = getDays()[currentDate] || [];
        tasks.forEach((task, index) => {
            const card = document.createElement('div');
            card.className = `task-card ${task.done ? 'completed' : ''}`;
            card.innerHTML = `<span>${task.text}</span>`;
            card.onclick = () => { const days = getDays(); days[currentDate][index].done = !days[currentDate][index].done; saveDays(days); loadTasks(); };
            let t;
            card.onmousedown = card.ontouchstart = () => { card.classList.add('delete-hold'); t = setTimeout(() => { const days = getDays(); days[currentDate].splice(index, 1); saveDays(days); loadTasks(); }, 1000); };
            card.onmouseup = card.ontouchend = () => { clearTimeout(t); card.classList.remove('delete-hold'); };
            taskGrid.appendChild(card);
        });
    }

    toggleMultiBtn.onclick = () => {
        multiSelect = !multiSelect;
        toggleMultiBtn.textContent = multiSelect ? "‚úÖ Se√ßim Yapƒ±n" : "‚ûï √áoklu Se√ßim";
        toggleMultiBtn.style.background = multiSelect ? "var(--success-color)" : "";
        toggleMultiBtn.style.color = multiSelect ? "white" : "";
        if(!multiSelect) { selectedDays = currentDate ? [currentDate] : []; renderCalendar(); }
    };

    document.getElementById('clearSelected').onclick = () => {
        if(selectedDays.length === 0) return;
        if(confirm("Se√ßilen g√ºnlerin g√∂revleri silinecek?")) { const days = getDays(); selectedDays.forEach(d => delete days[d]); saveDays(days); selectedDays = []; currentDate = null; renderCalendar(); loadTasks(); }
    };

    function updateDayCounter() {
        const days = getDays(); let d = 0, p = 0;
        for (const k in days) { if (days[k].length > 0) { if (days[k].every(t => t.done)) d++; else p++; } }
        document.getElementById('doneCount').textContent = d; document.getElementById('pendingCount').textContent = p;
    }

    function renderMonthDots() {
        const daysData = getDays(); const todayStr = new Date().toLocaleDateString('sv-SE');
        document.querySelectorAll('#monthDays button[data-date]').forEach(btn => {
            const iso = btn.dataset.date; const dot = btn.querySelector('.day-dot'); if(!dot) return;
            dot.className = 'day-dot';
            if (daysData[iso] && daysData[iso].length > 0) {
                if (daysData[iso].every(t => t.done)) dot.classList.add('dot-done');
                else if (iso < todayStr) dot.classList.add('dot-late');
                else dot.classList.add('dot-has');
            }
        });
    }

    addBtn.onclick = () => {
        const val = taskInput.value.trim(); if (!val || selectedDays.length === 0) return;
        const days = getDays();
        selectedDays.forEach(d => { if (!days[d]) days[d] = []; days[d].push({ text: val, done: false }); });
        saveDays(days); taskInput.value = ''; loadTasks();
    };

    const changeMonth = (dir) => {
        if(multiSelect) return;
        const [y, m] = monthInput.value.split("-").map(Number);
        let date = new Date(y, m - 1 + dir, 1);
        monthInput.value = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, "0")}`;
        renderCalendar();
    };

    let touchStartX = 0;
    monthDays.addEventListener("touchstart", e => { if(!multiSelect) touchStartX = e.changedTouches[0].screenX; }, {passive: true});
    monthDays.addEventListener("touchend", e => {
        if(multiSelect) return;
        let diff = e.changedTouches[0].screenX - touchStartX;
        if (Math.abs(diff) > 60) changeMonth(diff > 0 ? -1 : 1);
    }, {passive: true});
    monthDays.addEventListener("wheel", e => { if(!multiSelect) { changeMonth(e.deltaY > 0 ? 1 : -1); e.preventDefault(); } }, {passive: false});

    const now = new Date(); monthInput.value = `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}`;
    renderCalendar(); updateDayCounter();
    monthInput.onchange = renderCalendar;

    const dt = document.getElementById('darkToggle');
    dt.onclick = () => {
        document.body.classList.toggle('dark');
        const isDark = document.body.classList.contains('dark');
        dt.textContent = isDark ? "‚òÄÔ∏è" : "üåô";
        localStorage.setItem('theme', isDark ? 'dark' : 'light');
    };
    if(localStorage.getItem('theme') === 'dark') { document.body.classList.add('dark'); dt.textContent = "‚òÄÔ∏è"; }
    
    document.getElementById('backupBtn').onclick = () => {
        const a = document.createElement('a'); a.href = URL.createObjectURL(new Blob([JSON.stringify({days: getDays()})], {type: "application/json"}));
        a.download = `takip-yedek.json`; a.click();
    };
    document.getElementById('restoreBtn').onclick = () => {
        const file = document.getElementById('restoreInput').files[0]; if(!file) return;
        const reader = new FileReader(); reader.onload = (e) => { const d = JSON.parse(e.target.result); if(d.days) { saveDays(d.days); renderCalendar(); alert("Y√ºklendi"); } };
        reader.readAsText(file);
    };
});
</script>
</body>
</html>
