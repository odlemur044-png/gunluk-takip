<!DOCTYPE html>
<html lang="tr">
<head>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#2c3e50">
  <meta charset="UTF-8" />
  <title>G√ºnl√ºk Takip Programƒ±</title>
<!-- ‚≠ê EN ƒ∞Yƒ∞ S√úR√úM (STABLE) ‚Äì Bu s√ºr√ºm referans alƒ±narak geli≈ütirilecektir -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
  font-family: Arial, sans-serif;
  background: linear-gradient(135deg,#e8f5e9,#f4f6f8);
  padding:20px;
}
    h1 {
  text-align:center;
  margin-bottom:18px;
  letter-spacing:0.5px;
}
    .container {
  max-width:900px;
  margin:auto;
  background:#ffffff;
  padding:18px;
  border-radius:16px;
  box-shadow:0 10px 30px rgba(0,0,0,0.08);
}
    input, button {
  padding:10px;
  font-size:1rem;
  border-radius:10px;
  border:1px solid #ddd;
}

button {
  background:#f5f5f5;
  cursor:pointer;
  transition:background 0.2s, transform 0.15s, box-shadow 0.15s;
}

button:hover {
  background:#e0e0e0;
  box-shadow:0 4px 10px rgba(0,0,0,0.08);
}

button:active {
  transform:scale(0.97);
}

    .task-grid { display:grid; grid-template-columns:repeat(5,1fr); gap:10px; margin-top:15px; }
    .task-card {
  border:1px solid #ddd;
  border-radius:12px;
  padding:8px;
  min-height:unset;
  height:auto;
  display:flex;
  align-items:flex-start;
  word-break:break-word;
  line-height:1.35;
  background:#fafafa;
  transition:background 0.25s, border-color 0.25s, box-shadow 0.2s, transform 0.15s;
  user-select:none;
  -webkit-user-select:none;
  -ms-user-select:none;
}
}

.task-card:hover{
  transform:translateY(-2px);
  box-shadow:0 6px 14px rgba(0,0,0,0.08);
}

.task-card.completed {
  background:linear-gradient(135deg,#e8f5e9,#c8e6c9);
  border-color:#66bb6a;
}

.task-card.delete-hold{
  background:#ffebee !important;
  border-color:#e53935 !important;
  color:#b71c1c;
}
    .task-card.completed { background:#e8f5e9; border-color:#66bb6a; }
    .done { text-decoration:line-through; color:gray; }

    #monthDays {
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:6px;
  margin-top:10px;
}
#monthDays button{
  position:relative;
  border:1px solid #ddd;
  border-radius:10px;
  background:#fafafa;
  padding:8px 0 6px;
  font-size:0.85rem;
  min-height:36px;
  transition:transform .15s, box-shadow .15s, background .2s;
}
#monthDays button:hover{
  transform:translateY(-2px);
  box-shadow:0 4px 10px rgba(0,0,0,.08);
}
#monthDays button.active{
  background:#c8e6c9;
  border-color:#66bb6a;
}
#monthDays button.today{
  outline:2px solid #4caf50;
}
    #monthDays button { border:1px solid #ccc; border-radius:6px; background:#f8f9fa; padding:6px 0; font-size:0.8rem; min-height:32px; }
    #monthDays button.active { background:#c8e6c9; }

    .day-dot{ width:6px; height:6px; border-radius:50%; margin:2px auto 0; background:#fff; border:1px solid #ccc; }
    .dot-has{ background:#ffd54f; border-color:#fbc02d; }
    .dot-done{ background:#81c784; border-color:#4caf50; }

    #dayList { display:grid; grid-template-columns:repeat(auto-fill,minmax(120px,1fr)); gap:8px; margin-top:10px; }

    .delete-hold { background:#ffdddd !important; border-color:#ff5c5c !important; color:#a40000; }
    weekdays {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 6px;
  margin-top: 10px;
  font-weight: bold;
  text-align: center;
  color: #555;
}

.weekdays div {
  padding: 6px 0;
  font-size: 0.8rem;
}
    #weekDays {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 6px;
  margin-top: 10px;
  text-align: center;
  font-weight: bold;
  font-size: 0.8rem;
  color: #555;
}
    .goal-box {
  margin: 10px 0;
  padding: 10px;
  border-radius: 8px;
  background: #f4f6f8;
  font-size: 0.9rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
  </style>
</head>
<body>

<h1>üìã G√ºnl√ºk Takip Programƒ± <small style="font-size:0.8rem;color:#4caf50;">(En ƒ∞yi S√ºr√ºm)</small></h1>
<div class="container">
  <div id="goalBox" class="goal-box">
  <label>
    üéØ Hedef:
    <input type="number" id="goalInput" placeholder="√ñrn: 1100" style="width:80px;">
  </label>

  <button id="saveGoalBtn">Kaydet</button>

  <span style="margin-left:10px;">
    ‚è≥ Kalan: <b><span id="goalRemaining">0</span></b> g√ºn
  </span>
</div>
  <label><strong>Ay / Yƒ±l Se√ß:</strong></label>
  <input type="month" id="monthInput">
  <button id="toggleMulti" style="margin-top:6px;">‚ûï Birden Fazla G√ºn Se√ß</button>
  <button id="clearSelected" style="margin-top:6px;background:#ffdddd;border:1px solid #ff5c5c;">üßπ Se√ßilen G√ºnleri Temizle</button>
  <div id="weekDays" class="weekdays">
  <div>Pt</div>
  <div>Sl</div>
  <div>√ár</div>
  <div>Pr</div>
  <div>Cm</div>
  <div>Ct</div>
  <div>Pz</div>
</div>

  <div id="monthDays"></div>

  <hr>

  <label><strong>Yeni ƒ∞≈ü <small style="font-weight:normal;color:#666;font-size:0.85rem;">(silmek i√ßin basƒ±lƒ± tut)</small>:</strong></label>
  <input type="text" id="taskInput" placeholder="Yapƒ±lacak i≈üi yaz">
  <button id="addBtn">‚ûï ƒ∞≈ü Ekle</button>

  <div id="taskGrid" class="task-grid"></div>

  <hr>
  <details style="margin-top:15px;">
    <summary style="cursor:pointer;font-weight:bold;">üíæ Yedekleme</summary>
    <div style="margin-top:10px;">
      <button id="backupBtn">üì§ Yedek Al</button><br><br>
      <input type="file" id="restoreInput" accept="application/json"><br><br>
      <button id="restoreBtn">üì• Geri Y√ºkle</button>
    </div>
  </details>
</div>

<script>
function getGoal() {
  return Number(localStorage.getItem("goal")) || 0;
}

function setGoal(value) {
  localStorage.setItem("goal", value);
}

document.addEventListener('DOMContentLoaded', () => {

  let currentDate = null;
  let selectedDays = [];
  let multiSelect = false;

  const monthInput = document.getElementById('monthInput');
  const monthDays  = document.getElementById('monthDays');
  const taskGrid   = document.getElementById('taskGrid');
  const taskInput  = document.getElementById('taskInput');
  const addBtn     = document.getElementById('addBtn');
  const backupBtn  = document.getElementById('backupBtn');
  const restoreBtn = document.getElementById('restoreBtn');
  const restoreInput = document.getElementById('restoreInput');
  const clearSelectedBtn = document.getElementById('clearSelected');

  const goalInput = document.getElementById("goalInput");
  const saveGoalBtn = document.getElementById("saveGoalBtn");

  goalInput.value = getGoal();

  saveGoalBtn.onclick = () => {
    if (!goalInput.value || goalInput.value <= 0) {
      alert("L√ºtfen ge√ßerli bir hedef gir");
      return;
    }
    setGoal(goalInput.value);
    updateGoalStatus();
  };

  function getDays(){ return JSON.parse(localStorage.getItem('days')) || {}; }
  function saveDays(d){ localStorage.setItem('days', JSON.stringify(d)); }

  monthInput.addEventListener('change', () => {
    monthDays.innerHTML = '';
    selectedDays = [];
    currentDate = null;

    if(!monthInput.value) return;
    const [y,m] = monthInput.value.split('-').map(Number);
    const count = new Date(y,m,0).getDate();

    let firstDay = new Date(y, m - 1, 1).getDay();
    firstDay = (firstDay + 6) % 7;

    for (let i = 0; i < firstDay; i++) {
      const empty = document.createElement("div");
      monthDays.appendChild(empty);
    }

    for(let d=1; d<=count; d++){
      const iso = `${y}-${String(m).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
      const btn = document.createElement('button');
      btn.type='button';
      btn.textContent=d;
      btn.dataset.date=iso;

      const dot=document.createElement('div');
      dot.className='day-dot';

      const daysData=getDays();
      if(daysData[iso] && daysData[iso].length>0){
        const allDone = daysData[iso].every(t=>t.done);
        dot.classList.add(allDone?'dot-done':'dot-has');
      }

      btn.onclick = () => {
        if(btn._longPressed){ btn._longPressed=false; return; }
        const days=getDays();
        if(!days[iso]) days[iso]=[];

        if(!multiSelect){
          [...monthDays.children].forEach(b=>b.classList.remove('active'));
          selectedDays=[iso];
          btn.classList.add('active');
        }else{
          if(selectedDays.includes(iso)){
            selectedDays=selectedDays.filter(x=>x!==iso);
            btn.classList.remove('active');
          }else{
            selectedDays.push(iso);
            btn.classList.add('active');
          }
        }
        currentDate=iso;
        saveDays(days);
        loadDay();
        updateGoalStatus();
      };

      let holdTimer=null;
      const holdStart=()=>{
        btn._longPressed=false;
        btn.classList.add('delete-hold');
        holdTimer=setTimeout(()=>{
          btn._longPressed=true;
          btn.classList.remove('delete-hold');
          const days=getDays();
          if(days[iso]){
            if(confirm(iso+' g√ºn√ºndeki t√ºm g√∂revler silinsin mi?')){
              delete days[iso];
              saveDays(days);
              if(currentDate===iso) currentDate=null;
              loadDay();
              renderMonthDots();
              updateGoalStatus();
            }
          }
        },700);
      };
      const holdCancel=()=>{
        if(holdTimer) clearTimeout(holdTimer);
        btn.classList.remove('delete-hold');
      };

      btn.addEventListener('mousedown',holdStart);
      btn.addEventListener('mouseup',holdCancel);
      btn.addEventListener('mouseleave',holdCancel);
      btn.addEventListener('touchstart',holdStart);
      btn.addEventListener('touchend',holdCancel);
      btn.addEventListener('touchcancel',holdCancel);

      btn.appendChild(dot);
      monthDays.appendChild(btn);
    }
  });

  document.getElementById('toggleMulti').onclick=()=>{
    multiSelect=!multiSelect;
    document.getElementById('toggleMulti').textContent =
      multiSelect ? '‚úî √áoklu Se√ßim A√ßƒ±k' : '‚ûï Birden Fazla G√ºn Se√ß';
    if(!multiSelect && selectedDays.length>1) selectedDays=[selectedDays[0]];
  };

  clearSelectedBtn.onclick = () => {
    if(selectedDays.length===0) return alert('Temizlemek i√ßin g√ºn se√ß');
    if(!confirm(selectedDays.join(', ')+' g√ºnlerindeki T√úM g√∂revler silinsin mi?')) return;
    const days = getDays();
    selectedDays.forEach(d=>{ delete days[d]; });
    saveDays(days);
    selectedDays = [];
    currentDate = null;
    loadDay();
    renderMonthDots();
    updateGoalStatus();
    [...monthDays.children].forEach(b=>b.classList.remove('active'));
  };

  function loadDay(){
    taskGrid.innerHTML='';
    if(!currentDate) return;
    const days=getDays();
    const tasks=days[currentDate]||[];

    const maxSlots = Math.max( tasks.length + 2, 5 );
    for(let i=0;i<maxSlots;i++){
      const card=document.createElement('div');
      card.className='task-card';

      if(tasks[i]){
        card.textContent = tasks[i].text;
        if(tasks[i].done) card.classList.add('done','completed');

        card.onclick=()=>{
          tasks[i].done=!tasks[i].done;
          saveDays(days);
          loadDay();
          renderMonthDots();
          updateGoalStatus();
        };
      }else{
        card.style.opacity='0.3';
        card.textContent='Bo≈ü';
      }
      taskGrid.appendChild(card);
    }
  }

  function renderMonthDots(){
    [...monthDays.children].forEach(btn=>{
      const iso=btn.dataset.date;
      const dot=btn.querySelector('.day-dot');
      if(!dot) return;
      dot.className='day-dot';
      const days=getDays();
      if(days[iso] && days[iso].length>0){
        dot.classList.add(days[iso].every(t=>t.done)?'dot-done':'dot-has');
      }
    });
  }

  function updateGoalStatus() {
    const goal = getGoal();
    const days = getDays();
    let completedCount = 0;

    for (const date in days) {
      if (days[date].length > 0 && days[date].every(t => t.done)) {
        completedCount++;
      }
    }
    document.getElementById("goalRemaining").textContent =
      Math.max(goal - completedCount, 0);
  }

  backupBtn.onclick=()=>{
    const blob=new Blob([JSON.stringify({days:getDays()},null,2)],{type:'application/json'});
    const a=document.createElement('a');
    a.href=URL.createObjectURL(blob);
    a.download='gunluk-takip-yedek.json';
    a.click();
  };

  restoreBtn.onclick=()=>{
    const f=restoreInput.files[0];
    if(!f) return alert('Dosya se√ß');
    const r=new FileReader();
    r.onload=e=>{
      try{
        const d=JSON.parse(e.target.result);
        localStorage.setItem('days',JSON.stringify(d.days));
        loadDay();
        renderMonthDots();
        updateGoalStatus();
        alert('Yedek y√ºklendi');
      }catch{
        alert('Ge√ßersiz dosya');
      }
    };
    r.readAsText(f);
  };

  const now = new Date();
  monthInput.value = `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}`;
  monthInput.dispatchEvent(new Event('change'));
});
</script>

</body>
</html>
